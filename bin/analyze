#!/bin/env python
# -*- coding: utf-8 -*-

# Copyright 2013 by László Nagy
# This file is part of Beye [see file LICENSE.txt for more]

import os
import sys
import logging

import beye.analyze


def main():

    if (os.environ.get('CCC_ANALYZER_VERBOSE')):
        log_level = 'DEBUG'
    elif (os.environ.get('CCC_ANALYZER_LOG')):
        log_level = 'INFO'
    else:
        log_level = 'WARNING'

    logging.basicConfig(format='%(message)s', level=log_level)
    logging.info(' '.join(sys.argv))

    beye.analyze.run(
        command=sys.argv,
        analyses=split_env_content('CCC_ANALYZER_ANALYSIS'),
        plugins=split_env_content('CCC_ANALYZER_PLUGINS'),
        store_model=os.environ.get('CCC_ANALYZER_STORE_MODEL'),
        constraints_model=os.environ.get('CCC_ANALYZER_CONSTRAINTS_MODEL'),
        internal_stats=os.environ.get('CCC_ANALYZER_INTERNAL_STATS'),
        output_format=os.environ.get('CCC_ANALYZER_OUTPUT_FORMAT', 'html'),
        html_dir=os.environ.get('CCC_ANALYZER_HTML'))


def split_env_content(name):
    content = os.environ.get(name)
    return content.split() if content else []

# entry symbol
if __name__ == '__main__':
    main()
